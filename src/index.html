<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>That Sky Events - Calendar for Sky: Children of the Light</title>
  <meta name="description"
    content="Your complete community-driven calendar for Sky: Children of the Light featuring upcoming events, traveling spirits, seasonal celebrations, and daily quests.">
  <meta name="color-scheme" content="light">

  <!-- Open Graph Meta Tags (for social sharing) -->
  <meta property="og:title" content="That Sky Events Calendar">
  <meta property="og:description"
    content="Stay updated with Sky: Children of the Light events, traveling spirits, and seasonal celebrations.">
  <meta property="og:image" content="https://thatskyevents.netlify.app/assets/preview-skycotl.png">
  <meta property="og:url" content="https://thatskyevents.netlify.app/">
  <meta property="og:type" content="website">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="That Sky Events Calendar">
  <meta name="twitter:description"
    content="Stay updated with Sky: Children of the Light events, traveling spirits, and seasonal celebrations.">
  <meta name="twitter:image" content="https://thatskyevents.netlify.app/assets/preview-skycotl.png">

  <!-- Canonical URL -->
  <meta rel="canonical" href="https://thatskyevents.netlify.app/">

  <meta name="google-site-verification" content="wE5_GjQhxEZxniT4nB-VI50OlKfUy2C_BrV6rbvkXAE" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRC19V15XY"></script>

  <meta name="application-name" content="That Sky Events Calendar">
  <meta name="description"
    content="Stay updated with Sky: Children of the Light events, traveling spirits, and seasonal celebrations.">
  <meta name="keywords"
    content="Sky: Children of the Light, Sky, thatgamecompany, event calendar, seasonal events, sky cotl events, sky cotl calendar, Sky cotl game, Sky cotl guide, Sky cotl resources, Sky community, Sky events list, Sky event schedule, Sky cotl event dates, Sky cotl upcoming events, Sky cotl seasonal events, Sky cotl daily activities, Sky cotl celebrations">

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-DRC19V15XY');
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "That Sky Events",
      "url": "https://thatskyevents.netlify.app/",
      "description": "Community calendar for Sky: Children of the Light events",
    }
  </script>

  <!-- CSS and ICO -->
  <link rel="stylesheet" href="style2.css">
  <link rel="stylesheet" href="event_card.css">
  <link rel="stylesheet" href="event_notice.css">
  <link rel="stylesheet" href="calendar.css">
  <link rel="stylesheet" href="modal.css">
  <link rel="stylesheet" href="event_list.css">
  <link rel="stylesheet" href="credits.css">
  <link rel="stylesheet" href="subscription.css">
  <link rel="stylesheet" href="game_modal.css">
  <link rel="stylesheet" href="sticker.css">


  <link rel="icon" type="image/x-icon"
    href="https://ik.imagekit.io/e3wiv79bq/Sky:%20Cotl/logo.jpg?updatedAt=1745047743705">

  <!-- CALENDAR -->
  <script defer src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>

</head>

<body>
  <!-- LOADING OVERLAY -->
  <!-- <div class="overlay">
    <div class="loader"></div>
  </div> -->

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <!-- Logo -->
      <a href="#home" class="logo-link">
        <img class="logo" src="https://ik.imagekit.io/e3wiv79bq/Sky:%20Cotl/logo.jpg?updatedAt=1745047743705"
          alt="That Sky Events Calendar Logo - Sky: Children of the Light">
      </a>

      <!-- Hamburger Button -->
      <button type="button" class="menu-toggle" aria-label="Open menu" aria-expanded="false">
        ‚ò∞
      </button>

      <!-- Navigation Links -->
      <ul class="nav-links">
        <button type="button" class="close-btn" aria-label="Close menu">&times;</button>
        <li><a href="#home">Home</a></li>
        <li><a href="#calendarSection">Calendar</a></li>
        <li><a href="#eventsGrid">Events</a></li>
        <li><a href="#about">About</a></li>
        <li>
          <button type="button" id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
            <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
            </svg>
          </button>
        </li>
      </ul>

    </div>
  </nav>

  <!-- Overlay for mobile drawer -->
  <div class="nav-overlay"></div>

  <!-- Hero Banner -->
  <section class="hero-banner" id="home">
    <picture class="hero-background">
      <!-- Mobile image -->
      <source media="(max-width: 768px)"
        srcset="https://ik.imagekit.io/e3wiv79bq/Sky:%20Cotl/hero-img-port.jpg?tr=w-768,q-70,f-webp" type="image/webp">

      <!-- Desktop image -->
      <source media="(min-width: 769px)"
        srcset="https://ik.imagekit.io/e3wiv79bq/Sky:%20Cotl/hero-img.jpg?tr=w-1600,q-70,f-webp" type="image/webp">

      <!-- Fallback JPEG (in case WebP not supported) -->
      <img src="https://ik.imagekit.io/e3wiv79bq/Sky:%20Cotl/hero-img.jpg?tr=w-1600,q-70"
        alt="That Sky Events Hero Background" width="1600" height="900" loading="eager">
    </picture>

    <div class="hero-overlay"></div>

    <div class="hero-content">
      <h1 class="hero-title">That Sky Events</h1>
      <p class="hero-description">Stay updated with upcoming events, traveling spirits, and seasonal celebrations in the
        world of Sky.</p>
      <div class="hero-cta-container">
        <button type="button" class="subscription-cta" onclick="showCalendarSubscriptionInstructions()">
          üìÖ Subscribe to Sky Events Calendar
        </button>
        <a href="#calendar" class="secondary-cta">View Calendar</a>
      </div>
    </div>

    <div class="info-section">
      <div class="info-container">
        <h2>Heads Up</h2>
      </div>
      <div class="info-container game">
        <h2>Fancy a game?</h2>
        <p class="game-description">Challenge yourself with a round of memory game! Click to play.</p>
        <button type="button" id="open-game-modal">Play Game</button>
      </div>
    </div>
  </section>

  <!-- Floating Note Sticker Widget -->
  <div class="floating-note-sticker" id="noteSticker" style="display: none;">
    <div class="note-trigger" onclick="toggleNote()" aria-label="Toggle update note">
      <span class="note-icon">üìå</span>
    </div>
    <div class="note-content" id="noteContent">
      <div class="note-header">
        <div class="note-title">
          <span id="noteTypeIcon">‚ú®</span>
          <span id="noteTypeText">Update</span>
        </div>
        <button class="note-close" onclick="toggleNote()" aria-label="Close note">√ó</button>
      </div>
      <div class="note-message" id="noteMessage"></div>
      <div class="note-timestamp" id="noteTimestamp"></div>
    </div>
  </div>

  <!-- Scroll to Top Button -->
  <button type="button" id="scrollTopBtn" aria-label="Scroll to top">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
      stroke-linecap="round" stroke-linejoin="round">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>

  <!-- Quick Overview Section -->
  <section class="quick-overview" id="quick-overview">
    <h2 class="section-title">Quick Overview</h2>
    <div class="event-cards-overview" id="event-cards-container">
      <!-- Loading state (initially shown) -->
      <div class="loading-spinner"></div>
    </div>
  </section>

  <section id="calendarSection">

    <div class="calendar-subscription-banner">
      <h3>üìÖ Want these events in your own calendar?</h3>
      <p>Subscribe to get automatic updates for all Sky events, traveling spirits, and seasonal celebrations.</p>
      <button type="button" class="subscription-cta" onclick="showCalendarSubscriptionInstructions()">
        Subscribe Now
      </button>
    </div>

    <div class="calendar-info">
      <div style="margin-right: 10px;">
        <img src="https://img.icons8.com/?size=100&id=63308&format=png&color=000000" alt="Calendar Icon"
          style="width: 30px; height: 30px;">
      </div>
      <div>
        <p style="margin: 0;">Click on the events inside the calendar to see more details.</p>
      </div>
    </div>
    <div id='calendar' class="calendar"></div>
  </section>

  <!-- Event Cards Container -->
  <div class="events-grid" id="eventsGrid">
  </div>

  <!-- Credits Container -->
  <section class="credits-section" id="about">
    <h1>Image Credits & Acknowledgments</h1>

    <div class="credits-intro">
      <strong>That Sky Events</strong> is a community-created calendar and resource website for Sky: Children of the
      Light players. This is an unofficial fan project designed to help the Sky community stay informed about events and
      game information.
    </div>

    <h2>Game Assets & Screenshots</h2>
    <div class="credits-grid">
      <div class="credit-item">
        <div class="credit-label">Original Game:</div>
        <div class="credit-value">Sky: Children of the Light</div>
      </div>
      <div class="credit-item">
        <div class="credit-label">Developer/Publisher:</div>
        <div class="credit-value">thatgamecompany</div>
      </div>
      <div class="credit-item">
        <div class="credit-label">Copyright:</div>
        <div class="credit-value">¬© thatgamecompany. All rights reserved.</div>
      </div>
    </div>

    <p>All Sky: Children of the Light game imagery, assets, and screenshots are the intellectual property of
      <strong>thatgamecompany</strong>. These images are used for informational and educational purposes to help the Sky
      community.</p>

    <h2>Community Documentation</h2>
    <div class="credit-item">
      <div class="credit-label">Primary Source:</div>
      <div class="credit-value">
        <a href="https://sky-children-of-the-light.fandom.com/" target="_blank" rel="noopener">Sky: Children of the
          Light Wiki</a> hosted on Fandom
      </div>
    </div>

    <h3>Special Recognition</h3>
    <p>We acknowledge and thank all contributors to the Sky: Children of the Light Wiki, including administrators,
      editors, and image uploaders who have made comprehensive documentation possible. The wiki serves as an invaluable
      resource for the Sky community, and this calendar project would not be possible without their dedicated work.</p>

    <div class="legal-notice">
      <h3>Copyright Notice</h3>
      <p>All copyrighted materials used on this website remain the property of their respective copyright holders.
        Images are used for educational and informational purposes only, with no commercial intent.</p>

      <p>If you are a copyright holder and would like content removed or have concerns about usage, please contact us
        and we will promptly address your request.</p>
    </div>

    <div class="disclaimer">
      That Sky Events is an independent fan-created resource and is not affiliated with or endorsed by thatgamecompany.
      Sky: Children of the Light is a trademark of thatgamecompany.
    </div>
  </section>


  <!-- Modal -->
  <div class="modal-overlay" id="eventModal">
    <div class="event-modal">
      <div class="modal-header">
        <div class="modal-image-container" id="modalImageContainer">
          <!-- Image carousel will be inserted here -->
        </div>
        <button type="button" class="modal-close" id="closeModal">&times;</button>
        <div class="modal-badge" id="modalBadge"><!-- Badge text --></div>
      </div>
      <div class="modal-body">
        <h2 class="modal-title" id="modalTitle">Event Title</h2>

        <div class="quick-info-summary" id="quickInfoSummary">
          <!-- Quick info will be populated by JavaScript -->
        </div>

        <div class="modal-description" id="modalDescription">
          <!-- Description will be populated by JavaScript -->
        </div>

        <div class="modal-note" id="modalNote">
          <!-- Note/Reminder will be populated by JavaScript -->
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn share" id="modalShareBtn">
            <span class="btn-icon">üì§</span>
            Share Event
          </button>
          <button type="button" class="modal-btn calendar" id="modalCalendarBtn">
            <span class="btn-icon">üìÖ</span>
            Add to Calendar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Zoom Modal -->
  <div class="zoom-modal" id="zoomModal">
    <!-- Zoom content will be inserted here -->
  </div>

  <!-- Game Modal -->
  <div id="game-modal" class="game-modal" hidden>
    <div class="game-modal-content">
      <span class="close" aria-label="Close game modal">&times;</span>
      <div class="iframe-container">
        <iframe src="https://echoes-of-light.netlify.app/" title="Echoes of Light Memory Game" loading="lazy">
        </iframe>
      </div>
    </div>
  </div>

  <!-- Footer Section -->
  <footer class="footer">
    <div class="footer-container">
      <!-- Left Section -->
      <div class="footer-left">
        <a href="#home" class="footer-logo-link">
          <img class="footer-logo" src="https://ik.imagekit.io/e3wiv79bq/Sky:%20Cotl/logo.jpg?updatedAt=1745047743705"
            alt="That Sky Events Calendar Logo">
        </a>
        <p class="footer-text">
          Made with ‚ù§Ô∏è by
          <a href="https://kthjvr.github.io/Kathleen-Digital-Portfolio/" target="_blank" rel="noopener"
            class="footer-link">Kathy</a>
          ¬© 2024 ThatSkyEvents. All rights reserved.
        </p>
      </div>

      <!-- Right Section -->
      <div class="footer-right">
        <h2 class="footer-title">Need assistance?</h2>
        <p class="footer-help-text">
          I‚Äôm here to help! Contact me for any questions, requests, or navigation issues.
        </p>

        <!-- Social Links -->
        <div class="social-links">
          <a rel="noopener" href="https://discordapp.com/users/kx.linaa" target="_blank" class="social-icon">
            <img src="https://img.icons8.com/?size=100&id=LIGCjf5dKGrN&format=png&color=000000" alt="Discord icon">
            <span>Discord</span>
          </a>
          <a rel="noopener" href="https://www.instagram.com/thatgrumpycatto/" target="_blank" class="social-icon">
            <img src="https://img.icons8.com/?size=100&id=bh8L0hocH1mA&format=png&color=000000" alt="Instagram icon">
            <span>Instagram</span>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    class WebsiteManager {
      constructor() {
        this.state = {
          isMenuOpen: false,
          currentTheme: null
        };

        this.elements = {};
        this.init();
      }

      init() {
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => this.initializeComponents());
        } else {
          this.initializeComponents();
        }
      }

      cacheElements() {
        this.elements = {
          menuToggle: document.querySelector('.menu-toggle'),
          navLinks: document.querySelector('.nav-links'),
          navOverlay: document.querySelector('.nav-overlay'),
          closeBtn: document.querySelector('.close-btn'),
          scrollTopBtn: document.getElementById('scrollTopBtn'),
          themeToggle: document.getElementById('theme-toggle'),
          metaTheme: document.querySelector('meta[name="theme-color"]'),
          // Game modal elements
          gameModal: document.getElementById('game-modal'),
          openGameBtn: document.getElementById('open-game-modal'),
          closeGameBtn: document.querySelector('#game-modal .close')
        };
      }

      initializeComponents() {
        this.cacheElements();
        this.setInitialMenuState();
        this.initMobileMenu();
        this.initScrollToTop();
        this.initThemeManager();
        this.initCalendarSubscription();
        this.initGameModal();
      }

      initMobileMenu() {
        const { menuToggle, navLinks, navOverlay, closeBtn } = this.elements;

        if (!menuToggle || !navLinks) return;

        // Set initial state properly
        this.setInitialMenuState();

        menuToggle.addEventListener('click', (e) => {
          e.preventDefault();
          this.toggleMenu();
        });

        if (navOverlay) {
          navOverlay.addEventListener('click', () => this.closeMenu());
        }

        if (closeBtn) {
          closeBtn.addEventListener('click', () => this.closeMenu());
        }

        this.setupNavLinkHandlers();

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.state.isMenuOpen) {
            this.closeMenu();
          }
        });

        // Handle window resize to maintain correct state
        window.addEventListener('resize', () => this.handleResize());
      }

      setupNavLinkHandlers() {
        document.querySelectorAll('.nav-links a').forEach(link => {
          link.addEventListener('click', () => {
            if (this.state.isMenuOpen) {
              this.closeMenu();
            }
          });
        });
      }

      toggleMenu() {
        if (this.state.isMenuOpen) {
          this.closeMenu();
        } else {
          this.openMenu();
        }
      }

      openMenu() {
        const { menuToggle, navLinks, navOverlay } = this.elements;

        this.state.isMenuOpen = true;

        if (navLinks) {
          navLinks.style.display = 'block';
          navLinks.classList.add('active');

          // Use requestAnimationFrame to ensure smooth animation
          requestAnimationFrame(() => {
            navLinks.style.transform = 'translateX(0)';
          });
        }

        if (navOverlay) {
          navOverlay.classList.add('active');
          navOverlay.style.display = 'block';
        }

        if (menuToggle) {
          menuToggle.setAttribute('aria-expanded', 'true');
        }

        document.body.style.overflow = 'hidden';
      }

      closeMenu() {
        const { menuToggle, navLinks, navOverlay } = this.elements;

        this.state.isMenuOpen = false;

        if (navLinks) {
          navLinks.classList.remove('active');
          navLinks.style.transform = 'translateX(100%)'; // Slide off-screen

          // Hide after transition completes
          setTimeout(() => {
            if (!this.state.isMenuOpen) {
              navLinks.style.display = 'none';
            }
          }, 300);
        }

        if (navOverlay) {
          navOverlay.classList.remove('active');
          navOverlay.style.display = 'none';
        }

        if (menuToggle) {
          menuToggle.setAttribute('aria-expanded', 'false');
        }

        document.body.style.overflow = '';
      }

      setInitialMenuState() {
        const { navLinks, navOverlay, menuToggle } = this.elements;

        if (this.isMobile()) {
          // On mobile, ensure menu is hidden
          if (navLinks) {
            navLinks.classList.remove('active');
            navLinks.style.display = 'none';
            navLinks.style.transform = 'translateX(100%)';
          }

          if (navOverlay) {
            navOverlay.classList.remove('active');
            navOverlay.style.display = 'none';
          }

          if (menuToggle) {
            menuToggle.setAttribute('aria-expanded', 'false');
          }
        } else {
          if (navLinks) {
            navLinks.classList.remove('active');
            navLinks.style.display = 'flex';
            navLinks.style.transform = 'translateX(0)';
          }

          if (navOverlay) {
            navOverlay.style.display = 'none';
          }
        }

        this.state.isMenuOpen = false;
        document.body.style.overflow = '';
      }

      handleResize() {
        // Reset menu state on resize to prevent positioning issues
        this.setInitialMenuState();
      }

      isMobile() {
        return window.innerWidth <= 768;
      }

      initScrollToTop() {
        const { scrollTopBtn } = this.elements;

        if (!scrollTopBtn) return;

        let scrollTimeout = null;

        window.addEventListener('scroll', () => {
          if (scrollTimeout) return;

          scrollTimeout = setTimeout(() => {
            this.handleScroll();
            scrollTimeout = null;
          }, 16);
        });

        scrollTopBtn.addEventListener('click', () => {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      }

      handleScroll() {
        const { scrollTopBtn } = this.elements;

        if (window.scrollY > 200) {
          scrollTopBtn?.classList.add('show');
        } else {
          scrollTopBtn?.classList.remove('show');
        }
      }

      initThemeManager() {
        const { themeToggle } = this.elements;

        this.state.currentTheme = this.getStoredTheme() || this.getSystemTheme();
        this.applyTheme(this.state.currentTheme);

        if (themeToggle) {
          themeToggle.addEventListener('click', () => this.toggleTheme());
        }

        this.setupSystemThemeListener();
      }

      getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      getStoredTheme() {
        try {
          return localStorage.getItem('sky-events-theme');
        } catch (error) {
          console.warn('localStorage not available:', error);
          return null;
        }
      }

      setStoredTheme(theme) {
        try {
          localStorage.setItem('sky-events-theme', theme);
        } catch (error) {
          console.warn('Could not save theme to localStorage:', error);
        }
      }

      applyTheme(theme) {
        this.state.currentTheme = theme;
        document.documentElement.setAttribute('data-theme', theme);

        const { metaTheme } = this.elements;
        if (metaTheme) {
          const themeColor = theme === 'dark' ? '#1a1f2e' : '#fafafa';
          metaTheme.setAttribute('content', themeColor);
        }
      }

      toggleTheme() {
        const newTheme = this.state.currentTheme === 'light' ? 'dark' : 'light';
        this.applyTheme(newTheme);
        this.setStoredTheme(newTheme);

        this.addToggleAnimation();
      }

      addToggleAnimation() {
        const { themeToggle } = this.elements;
        if (!themeToggle) return;

        themeToggle.style.transform = 'scale(0.95)';
        setTimeout(() => {
          themeToggle.style.transform = '';
        }, 100);
      }

      setupSystemThemeListener() {
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

        mediaQuery.addEventListener('change', (e) => {
          if (!this.getStoredTheme()) {
            this.applyTheme(e.matches ? 'dark' : 'light');
          }
        });
      }

      initCalendarSubscription() {
        // Close modal when clicking outside
        document.addEventListener('click', (event) => {
          if (event.target.classList.contains('calendar-instructions-modal')) {
            event.target.remove();
          }
        });

        // Close modal with escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            const modal = document.querySelector('.calendar-instructions-modal');
            if (modal) {
              modal.remove();
            }
          }
        });
      }

      setTheme(theme) {
        if (theme === 'light' || theme === 'dark') {
          this.applyTheme(theme);
          this.setStoredTheme(theme);
          return true;
        }
        return false;
      }

      resetToSystemTheme() {
        try {
          localStorage.removeItem('sky-events-theme');
        } catch (error) {
          console.warn('Could not clear theme from localStorage:', error);
        }

        this.applyTheme(this.getSystemTheme());
      }

      getCurrentTheme() {
        return this.state.currentTheme;
      }

      isMenuOpen() {
        return this.state.isMenuOpen;
      }

      initGameModal() {
        this.cacheGameElements();
        this.setupGameEventListeners();
      }

      cacheGameElements() {
        this.elements.gameModal = document.getElementById('game-modal');
        this.elements.openGameBtn = document.getElementById('open-game-modal');
        this.elements.closeGameBtn = document.querySelector('#game-modal .close');
      }

      setupGameEventListeners() {
        const { gameModal, openGameBtn, closeGameBtn } = this.elements;

        if (!gameModal || !openGameBtn) return;
        openGameBtn.addEventListener('click', () => this.openGameModal());

        if (closeGameBtn) {
          closeGameBtn.addEventListener('click', () => this.closeGameModal());
        }

        gameModal.addEventListener('click', (e) => {
          if (e.target === gameModal) {
            this.closeGameModal();
          }
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.isGameModalOpen()) {
            this.closeGameModal();
          }
        });
      }

      openGameModal() {
        const { gameModal } = this.elements;
        if (!gameModal) return;
        document.body.style.overflow = 'hidden';

        gameModal.removeAttribute('hidden');

        requestAnimationFrame(() => {
          gameModal.classList.add('show');
        });

        const closeBtn = gameModal.querySelector('.close');
        if (closeBtn) {
          closeBtn.focus();
        }

        console.log('Game modal opened');
      }

      closeGameModal() {
        const { gameModal } = this.elements;
        if (!gameModal) return;

        gameModal.classList.remove('show');

        setTimeout(() => {
          gameModal.setAttribute('hidden', '');
          document.body.style.overflow = '';
        }, 250);

        const openBtn = this.elements.openGameBtn;
        if (openBtn) {
          openBtn.focus();
        }

        console.log('Game modal closed');
      }

      isGameModalOpen() {
        const { gameModal } = this.elements;
        return gameModal && gameModal.classList.contains('show');
      }

      destroy() {
        document.body.style.overflow = '';
        this.closeMenu();
        this.closeGameModal();
      }
    }

    // Enhanced device detection
    function detectDevice() {
      const userAgent = navigator.userAgent;
      const platform = navigator.platform;
      const maxTouchPoints = navigator.maxTouchPoints || 0;

      // Detect specific devices and platforms
      const detection = {
        // Mobile Operating Systems
        isIOS: /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream,
        isAndroid: /Android/.test(userAgent),
        isWindowsPhone: /Windows Phone/.test(userAgent),

        // Desktop Operating Systems
        isWindows: /Win/.test(platform) || /Windows/.test(userAgent),
        isMacOS: /Mac/.test(platform) && !(/iPad|iPhone|iPod/.test(userAgent)),
        isLinux: /Linux/.test(platform) && !/Android/.test(userAgent),
        isChromebook: /CrOS/.test(userAgent),

        // Browsers
        isChrome: /Chrome/.test(userAgent) && !/Edge|Edg/.test(userAgent),
        isSafari: /Safari/.test(userAgent) && !/Chrome|Edge|Edg/.test(userAgent),
        isFirefox: /Firefox/.test(userAgent),
        isEdge: /Edge|Edg/.test(userAgent),

        // Device types
        isMobile: /Mobi|Android/i.test(userAgent) || maxTouchPoints > 0 && window.innerWidth <= 768,
        isTablet: (/iPad/.test(userAgent)) || (maxTouchPoints > 0 && window.innerWidth > 768 && window.innerWidth <= 1024),
        isDesktop: !(/Mobi|Android|iPad|iPhone|iPod/.test(userAgent)) && maxTouchPoints === 0,

        hasTouch: maxTouchPoints > 0 || 'ontouchstart' in window,
        isStandalone: window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches
      };

      // Determine primary platform category
      if (detection.isIOS) detection.platform = 'ios';
      else if (detection.isAndroid) detection.platform = 'android';
      else if (detection.isMacOS) detection.platform = 'macos';
      else if (detection.isWindows) detection.platform = 'windows';
      else if (detection.isLinux) detection.platform = 'linux';
      else detection.platform = 'unknown';

      // Determine device category
      if (detection.isMobile) detection.deviceType = 'mobile';
      else if (detection.isTablet) detection.deviceType = 'tablet';
      else detection.deviceType = 'desktop';

      return detection;
    }

    // Calendar subscription functions with enhanced device detection
    function showCalendarSubscriptionInstructions() {
      const device = detectDevice();
      const modal = document.createElement('div');
      modal.className = 'calendar-instructions-modal';

      // console.log('Device detection:', device); // For debugging

      // Build dynamic content based on device
      let title = 'Subscribe to Sky Events Calendar';
      let description = 'Add this calendar to stay updated with all Sky events:';
      let buttons = '';

      // Customize based on platform
      if (device.isIOS) {
        title = 'üì± Add to your iPhone/iPad Calendar';
        description = 'Tap below to add Sky Events directly to your Apple Calendar:';
        buttons += `<button onclick="subscribeToAppleCalendar()" class="primary-option">üìÖ Add to Apple Calendar</button>`;
        buttons += `<button onclick="subscribeToGoogleCalendar()">üìä Add to Google Calendar</button>`;
      } else if (device.isAndroid) {
        title = 'üì± Add to your Android Calendar';
        description = 'Tap below to add Sky Events to your preferred calendar app:';
        buttons += `<button onclick="subscribeToGoogleCalendar()" class="primary-option">üìä Add to Google Calendar</button>`;
        buttons += `<button onclick="subscribeToAppleCalendar()">üìÖ Try Apple Calendar</button>`;
      } else if (device.isMacOS) {
        title = 'üíª Add to your Mac Calendar';
        description = 'Choose your preferred calendar application:';
        buttons += `<button onclick="subscribeToAppleCalendar()" class="primary-option">üìÖ Apple Calendar</button>`;
        buttons += `<button onclick="subscribeToGoogleCalendar()">üìä Google Calendar</button>`;
      } else if (device.isWindows) {
        title = 'üíª Add to your Windows Calendar';
        description = 'Choose your preferred calendar application:';
        buttons += `<button onclick="subscribeToGoogleCalendar()" class="primary-option">üìä Google Calendar</button>`;
        buttons += `<button onclick="subscribeToOutlookCalendar()">üìß Outlook Calendar</button>`;
        buttons += `<button onclick="subscribeToAppleCalendar()">üìÖ Apple Calendar</button>`;
      } else {
        buttons += `<button onclick="subscribeToGoogleCalendar()" class="primary-option">üìä Google Calendar</button>`;
        buttons += `<button onclick="subscribeToAppleCalendar()">üìÖ Apple Calendar</button>`;
        buttons += `<button onclick="subscribeToOutlookCalendar()">üìß Outlook Calendar</button>`;
      }

      // Always include copy URL option
      buttons += `<button onclick="copyCalendarUrl()" class="secondary-option">üìã Copy Calendar URL</button>`;

      // Add device-specific instructions
      let instructions = '';
      if (device.isMobile && device.isIOS) {
        instructions = '<p class="device-instructions">üí° After tapping, Safari will ask to add the calendar subscription.</p>';
      } else if (device.isMobile && device.isAndroid) {
        instructions = '<p class="device-instructions">üí° You may need to open the link in your calendar app.</p>';
      } else if (device.isDesktop) {
        instructions = '<p class="device-instructions">üí° Links will open in your default browser and calendar application.</p>';
      }

      modal.innerHTML = `
        <div class="modal-content">
          <h3>${title}</h3>
          <p>${description}</p>
          ${instructions}
          <div class="subscription-options">
            ${buttons}
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="close-button">Close</button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function subscribeToGoogleCalendar() {
      const calendarUrl = 'http://development--thatskyevents.netlify.app/.netlify/functions/calendar';
      const googleUrl = `https://calendar.google.com/calendar/u/0/r?cid=${encodeURIComponent(calendarUrl)}`;
      window.open(googleUrl, '_blank');
    }

    function subscribeToAppleCalendar() {
      const url = 'http://development--thatskyevents.netlify.app/.netlify/functions/calendar';
      window.location.href = url; // iOS Safari will open a prompt to subscribe
    }

    function subscribeToOutlookCalendar() {
      const calendarUrl = 'http://development--thatskyevents.netlify.app/.netlify/functions/calendar';
      const outlookUrl = `https://outlook.live.com/calendar/0/addcalendar?url=${encodeURIComponent(calendarUrl)}`;
      window.open(outlookUrl, '_blank');
    }

    // Initialize WebsiteManager
    let websiteManager = null;

    if (typeof window !== 'undefined') {
      websiteManager = new WebsiteManager();

      window.setTheme = (theme) => websiteManager?.setTheme(theme);
      window.resetTheme = () => websiteManager?.resetToSystemTheme();
      window.getCurrentTheme = () => websiteManager?.getCurrentTheme();
    }

    if (typeof module !== 'undefined' && module.exports) {
      module.exports = WebsiteManager;
    }
  </script>

</body>

</html>